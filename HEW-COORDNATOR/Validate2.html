<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validate Data | D-HEIRS</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/logout.css">
    <link rel="stylesheet" href="../focal/css/focal_dashboard.css">
    <link rel="stylesheet" href="coordinator_dashboard.css">

    <style>
        .form-card {
            background: white;
            padding: 3rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-main);
        }

        .form-select {
            width: 100%;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-family: var(--font-body);
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-family: var(--font-body);
            font-size: 1rem;
            margin-bottom: 2rem;
            min-height: 150px;
            resize: vertical;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1);
        }

        .btn-submit {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 6px rgba(15, 118, 110, 0.2);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(15, 118, 110, 0.3);
        }

        .step-indicator {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
            justify-content: center;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            background: #f3f4f6;
            color: var(--text-muted);
        }

        .step.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 8px rgba(15, 118, 110, 0.3);
        }
    </style>
</head>

<body class="dashboard-body">

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="brand-icon"><img src="images/images.jpg" alt="Logo"></div>
            <div class="brand-text">D-HEIRS <span>Coordinator Portal</span></div>
        </div>
        <nav class="sidebar-nav">
            <a href="coordinator_dashboard.html" class="nav-item"><i class="fa-solid fa-grid-2"></i>
                <span>Dashboard</span></a>
            <a href="monitor2.html" class="nav-item"><i class="fa-solid fa-chart-line"></i> <span>Monitor
                    Activity</span></a>
            <a href="Review_HEW_Report.php" class="nav-item"><i class="fa-solid fa-file-invoice"></i> <span>Review
                    Reports</span></a>
            <a href="validate2.html" class="nav-item active"><i class="fa-solid fa-check-double"></i> <span>Validate
                    Data</span></a>
            <a href="forward2.html" class="nav-item"><i class="fa-solid fa-paper-plane"></i> <span>Forward
                    Data</span></a>
        </nav>
        <div class="sidebar-footer">
            <a href="../index.html" class="nav-item logout"><i class="fa-solid fa-arrow-right-from-bracket"></i>
                <span>Logout</span></a>
        </div>
    </aside>

    <main class="main-content">
        <header class="dashboard-header">
            <div class="header-text">
                <h1>Validate Collected Data</h1>
                <p style="color: var(--text-muted);">Confirm data accuracy and mark service reports as official records.
                </p>
            </div>
        </header>

        <section class="form-card">
            <div class="step-indicator">
                <div class="step"><i class="fa-solid fa-1"></i></div>
                <div class="step active"><i class="fa-solid fa-2"></i></div>
                <div class="step"><i class="fa-solid fa-3"></i></div>
            </div>

            <h3 style="text-align:center; margin-bottom:2rem; color:var(--text-main);">Final Verification Form</h3>

            <form id="validationForm">
                <label for="dataSelect" class="form-label">Select Service Type to Validate</label>
                <select id="dataSelect" class="form-select" required>
                    <option value="">-- Choose Data Category --</option>
                    <option value="household data">Household Demographics</option>
                    <option value="maternal_health">Maternal Health (ANC/PNC)</option>
                    <option value="child_health">Child Health</option>
                    <option value="immunization">Immunization (Child)</option>
                    <option value="sanitation">Environmental Sanitation</option>
                    <option value="disease_surveillance">Disease Surveillance (Malaria/TB)</option>
                </select>

                <label id="textareaLabel" for="validationDetailsTextarea" class="form-label">Validation Notes &
                    Remarks</label>
                <textarea id="validationDetailsTextarea" class="form-textarea"
                    placeholder="Please select a data type first..." disabled></textarea>

                <button type="submit" class="btn-primary" style="width:100%; justify-content:center; margin-top:1rem;">
                    <i class="fa-solid fa-circle-check"></i> Mark as Validated
                </button>
            </form>
        </section>

    </main>

    <script>
        // Ensure the DOM is fully loaded before running the script
        document.addEventListener('DOMContentLoaded', function () {
            const dataSelect = document.getElementById('dataSelect');
            const textareaLabel = document.getElementById('textareaLabel');
            const validationDetailsTextarea = document.getElementById('validationDetailsTextarea');
            const validationForm = document.getElementById('validationForm');

            // Function to update textarea state
            function updateTextareaState() {
                const selectedOptionText = dataSelect.options[dataSelect.selectedIndex].textContent.trim();
                const selectedOptionValue = dataSelect.value;

                if (selectedOptionValue === "") {
                    // No valid option selected (placeholder)
                    validationDetailsTextarea.disabled = true;
                    validationDetailsTextarea.required = false;
                    validationDetailsTextarea.value = ''; // Clear content
                    validationDetailsTextarea.placeholder = 'Validation details will be enabled here after you choose a data type.';
                    textareaLabel.textContent = 'Please select a data type below to enter validation details:';
                    validationDetailsTextarea.name = 'validation_details'; // Reset generic name
                } else {
                    // A valid option is selected
                    validationDetailsTextarea.disabled = false;
                    validationDetailsTextarea.required = true;
                    validationDetailsTextarea.placeholder = `Provide specific data points, discrepancies, or notes for "${selectedOptionText}" here...`;
                    textareaLabel.textContent = `Enter validation details for "${selectedOptionText}":`;
                    validationDetailsTextarea.name = selectedOptionValue + '_details'; // Update name for submission
                }
            }

            if (dataSelect) {
                dataSelect.addEventListener('change', updateTextareaState);
            }

            if (validationForm) {
                validationForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const dataType = dataSelect.value;
                    if (!dataType) {
                        alert("Please select data type");
                        return;
                    }

                    // Call API using Fetch
                    fetch('../api/hew_coordinator.php?action=validate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            dataType: dataType,
                            details: validationDetailsTextarea.value
                        })
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                alert("Validation Successful! Records updated: " + (data.affected_rows || 0));
                                // Reset form
                                validationDetailsTextarea.value = '';
                                dataSelect.value = '';
                                updateTextareaState();
                            } else {
                                alert("Validation Error: " + data.message);
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            alert("Network Error during validation.");
                        });
                });
            }

        });
    </script>
    <script src="../js/logout.js"></script>
    <script src="mobile_nav.js"></script>
</body>

</html>
```